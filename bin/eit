#!/usr/bin/env ruby

opts = lambda{ |opt| opt.start_with?('-') }
args = ARGV.select(&opts)
pths = ARGV.reject(&opts)
nons = pths.select{ |p| !File.exist?(p) }
prog = case editor = ENV['EIT_EDITOR'] || ENV['EDITOR'] || 'vim'
       when 'textmate'; %w[open -a /Applications/TextMate.app]
       when 'sublime2'; %w[subl --new-window]
       else           ; [editor]
       end

cmds = prog + args + pths

if nons.empty?
  puts(cmds.join(' '))
  system(*cmds)
end

puts "#{nons.map{|p|"'#{p}'"}.join(', ')} were not existed." if nons.any?

exit unless $DEBUG

$DEBUG = false
require 'highline'
$DEBUG = true
H = HighLine.new

'eit
 eit --help
 eit asd
 eit ~/.bash_profile
 eit ~/.bash_profile asd'.split("\n").map(&:strip).each do |cmd|
 puts `#{cmd}`
 puts "Command: #{cmd}"
 exit if H.choose('y', 'n') == 'n'
 puts
end
